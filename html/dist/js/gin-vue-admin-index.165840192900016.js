/*! 
 Build based on gin-vue-admin 
 Time : 1658401929000 */
var e=(e,l,a)=>new Promise(((t,i)=>{var o=e=>{try{d(a.next(e))}catch(l){i(l)}},u=e=>{try{d(a.throw(e))}catch(l){i(l)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);d((a=a.apply(e,l)).next())}));import l from"./gin-vue-admin-fieldDialog.1658401929000.js";import a from"./gin-vue-admin-previewCodeDialg.1658401929000.js";import{a as t,b as i,t as o,c as u}from"./gin-vue-admin-stringFun.1658401929000.js";import{p as d,c as n,g as s,a as r,b as m,d as p,e as c}from"./gin-vue-admin-autoCode.1658401929000.js";import{u as v}from"./gin-vue-admin-dictionary.1658401929000.js";import{_ as f,D as b,u as g,a as y,r as N,S as h,b as k,o as _,c as V,e as w,d as x,w as C,F as T,z,q as U,ae as S,h as q,t as F,f as j,p as D,l as L,i as J,af as A}from"../gva/gin-vue-admin-index.1658401929000.js";import{W as O}from"./gin-vue-admin-warningBar.1658401929000.js";import"./gin-vue-admin-sysDictionary.1658401929000.js";const P=e=>(D("data-v-1a253fc4"),e=e(),L(),e),B={class:"gva-search-box"},E={style:{fontSize:"16px",paddingLeft:"20px"}},M=q(" 点这里从现有数据库创建代码 "),$=q("使用此表创建"),I={class:"gva-search-box"},R=P((()=>x("div",null," 自动创建API ",-1))),X=P((()=>x("div",null," 自动移动文件 ",-1))),W={class:"gva-table-box"},G={class:"gva-btn-list"},H=q("新增Field"),K=q("编辑"),Q=q("上移"),Y=q("下移"),Z=P((()=>x("p",null,"确定删除吗？",-1))),ee={style:{"text-align":"right","margin-top":"8px"}},le=q("取消"),ae=q("确定"),te=q("删除"),ie={class:"gva-btn-list justify-content-flex-end auto-btn-list"},oe=q("预览代码"),ue=q("生成代码"),de={class:"dialog-footer"},ne=q("取 消"),se=q("确 定"),re={class:"previewCodeTool"},me=P((()=>x("p",null,"操作栏：",-1))),pe=q("全选"),ce=q("复制"),ve={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},fe=q("确 定"),be={name:"AutoCode"};var ge=f(Object.assign(be,{setup(f){const D={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",require:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""},L=b(),P=g(),be=y([]),ge=N({}),ye=N({dbName:"",tableName:""}),Ne=N([]),he=N([]),ke=N(""),_e=N({}),Ve=N({structName:"",tableName:"",packageName:"",package:"",abbreviation:"",description:"",autoCreateApiToSql:!0,autoMoveFile:!0,fields:[]}),we=N({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}],package:[{required:!0,message:"请选择package",trigger:"blur"}]}),xe=N({}),Ce=N({}),Te=N(!1),ze=N(!1),Ue=N(null),Se=()=>{Ue.value.selectText()},qe=()=>{Ue.value.copy()},Fe=e=>{Te.value=!0,e?(ke.value="edit",Ce.value=JSON.parse(JSON.stringify(e)),xe.value=e):(ke.value="add",xe.value=JSON.parse(JSON.stringify(D)))},je=A(),De=()=>{je.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;xe.value.fieldName=i(xe.value.fieldName),"add"===ke.value&&Ve.value.fields.push(xe.value),Te.value=!1}))},Le=()=>{"edit"===ke.value&&(xe.value=Ce.value),Te.value=!1},Je=N(null),Ae=l=>e(this,null,(function*(){return Ve.value.fields.length<=0?(J({type:"error",message:"请填写至少一个field"}),!1):Ve.value.fields.some((e=>e.fieldName===Ve.value.structName))?(J({type:"error",message:"存在与结构体同名的字段"}),!1):void Je.value.validate((a=>e(this,null,(function*(){var e;if(!a)return!1;for(const l in Ve.value)"string"==typeof Ve.value[l]&&(Ve.value[l]=Ve.value[l].trim());if(Ve.value.structName=i(Ve.value.structName),Ve.value.tableName=Ve.value.tableName.replace(" ",""),Ve.value.tableName||(Ve.value.tableName=o(t(Ve.value.structName))),Ve.value.structName===Ve.value.abbreviation)return J({type:"error",message:"structName和struct简称不能相同"}),!1;if(Ve.value.humpPackageName=o(Ve.value.packageName),l){const e=yield d(Ve.value);ge.value=e.data.autoCode,ze.value=!0}else{const l=yield n(Ve.value);if("false"===(null==(e=l.headers)?void 0:e.success))return;if(Ve.value.autoMoveFile)return void J({type:"success",message:"自动化代码创建成功，自动移动成功"});J({type:"success",message:"自动化代码创建成功，正在下载"});const a=new Blob([l]),t="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(a),l=document.createElement("a");l.style.display="none",l.href=e,l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(a,t)}}))))})),Oe=()=>e(this,null,(function*(){const e=yield p();0===e.code&&(Ne.value=e.data.dbs)})),Pe=()=>e(this,null,(function*(){const e=yield s({dbName:ye.value.dbName});0===e.code&&(he.value=e.data.tables),ye.value.tableName=""})),Be=()=>e(this,null,(function*(){const e=["id","created_at","updated_at","deleted_at"],l=yield r(ye.value);if(0===l.code){const a=u(ye.value.tableName);Ve.value.structName=i(a),Ve.value.tableName=ye.value.tableName,Ve.value.packageName=a,Ve.value.abbreviation=a,Ve.value.description=a+"表",Ve.value.autoCreateApiToSql=!0,Ve.value.autoMoveFile=!0,Ve.value.fields=[],l.data.columns&&l.data.columns.forEach((l=>{if(!e.some((e=>e===l.columnName))){const e=u(l.columnName);Ve.value.fields.push({fieldName:i(e),fieldDesc:l.columnComment||e+"字段",fieldType:_e.value[l.dataType],dataType:l.dataType,fieldJson:e,dataTypeLong:l.dataTypeLong&&l.dataTypeLong.split(",")[0],columnName:l.columnName,comment:l.columnComment,require:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""})}}))}})),Ee=()=>e(this,null,(function*(){["string","int","bool","float64","time.Time"].forEach((l=>e(this,null,(function*(){const a=yield(t=l,e(void 0,null,(function*(){const e=v();return yield e.getDictionary(t),e.dictionaryMap[t]})));var t;a&&a.forEach((e=>{_e.value[e.label]=l}))}))))})),Me=l=>e(this,null,(function*(){const e=yield c({id:Number(l)});0===e.code&&(Ve.value=JSON.parse(e.data.meta))})),$e=N([]),Ie=()=>e(this,null,(function*(){const e=yield m();0===e.code&&($e.value=e.data.pkgs)})),Re=()=>{P.push({name:"autoPkg"})},Xe=()=>{Oe(),Ee(),Ie();const e=L.params.id;e&&Me(e)};return Xe(),h((()=>L.params.id),(e=>{"autoCodeEdit"===L.name&&Xe()})),(e,i)=>{const o=k("pointer"),u=k("el-icon"),d=k("el-option"),n=k("el-select"),s=k("el-form-item"),r=k("el-button"),m=k("el-form"),p=k("el-collapse-item"),c=k("el-collapse"),v=k("el-input"),f=k("refresh"),b=k("document-add"),g=k("el-tooltip"),y=k("el-checkbox"),N=k("el-table-column"),h=k("el-popover"),D=k("el-table"),L=k("el-dialog");return _(),V("div",null,[w(O,{href:"https://www.bilibili.com/video/BV1kv4y1g7nT?p=3",title:"此功能为开发环境使用，不建议发布到生产，具体使用效果请看视频https://www.bilibili.com/video/BV1kv4y1g7nT?p=3"}),x("div",B,[w(c,{modelValue:be,"onUpdate:modelValue":i[2]||(i[2]=e=>S(be)?be.value=e:null),style:{"margin-bottom":"12px"}},{default:C((()=>[w(p,{name:"1"},{title:C((()=>[x("div",E,[M,w(u,{class:"header-icon"},{default:C((()=>[w(o)])),_:1})])])),default:C((()=>[w(m,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:ye.value,"label-width":"120px"},{default:C((()=>[w(s,{label:"数据库名",prop:"structName"},{default:C((()=>[w(n,{modelValue:ye.value.dbName,"onUpdate:modelValue":i[0]||(i[0]=e=>ye.value.dbName=e),filterable:"",placeholder:"请选择数据库",onChange:Pe},{default:C((()=>[(_(!0),V(T,null,z(Ne.value,(e=>(_(),U(d,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(s,{label:"表名",prop:"structName"},{default:C((()=>[w(n,{modelValue:ye.value.tableName,"onUpdate:modelValue":i[1]||(i[1]=e=>ye.value.tableName=e),disabled:!ye.value.dbName,filterable:"",placeholder:"请选择表"},{default:C((()=>[(_(!0),V(T,null,z(he.value,(e=>(_(),U(d,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),w(s,null,{default:C((()=>[w(r,{size:"small",type:"primary",onClick:Be},{default:C((()=>[$])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),x("div",I,[w(m,{ref_key:"autoCodeForm",ref:Je,rules:we.value,model:Ve.value,size:"small","label-width":"120px",inline:!0},{default:C((()=>[w(s,{label:"Struct名称",prop:"structName"},{default:C((()=>[w(v,{modelValue:Ve.value.structName,"onUpdate:modelValue":i[3]||(i[3]=e=>Ve.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),w(s,{label:"TableName",prop:"tableName"},{default:C((()=>[w(v,{modelValue:Ve.value.tableName,"onUpdate:modelValue":i[4]||(i[4]=e=>Ve.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),w(s,{label:"Struct简称",prop:"abbreviation"},{default:C((()=>[w(v,{modelValue:Ve.value.abbreviation,"onUpdate:modelValue":i[5]||(i[5]=e=>Ve.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),w(s,{label:"Struct中文名称",prop:"description"},{default:C((()=>[w(v,{modelValue:Ve.value.description,"onUpdate:modelValue":i[6]||(i[6]=e=>Ve.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),w(s,{label:"文件名称",prop:"packageName"},{default:C((()=>[w(v,{modelValue:Ve.value.packageName,"onUpdate:modelValue":i[7]||(i[7]=e=>Ve.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:i[8]||(i[8]=e=>{var l,a;(l=Ve.value)[a="packageName"]=t(l[a])})},null,8,["modelValue"])])),_:1}),w(s,{label:"Package（包）",prop:"package"},{default:C((()=>[w(n,{modelValue:Ve.value.package,"onUpdate:modelValue":i[9]||(i[9]=e=>Ve.value.package=e),style:{width:"194px"}},{default:C((()=>[(_(!0),V(T,null,z($e.value,(e=>(_(),U(d,{key:e.ID,value:e.packageName,label:e.packageName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),w(u,{class:"auto-icon",onClick:Ie},{default:C((()=>[w(f)])),_:1}),w(u,{class:"auto-icon",onClick:Re},{default:C((()=>[w(b)])),_:1})])),_:1}),w(s,null,{label:C((()=>[w(g,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:C((()=>[R])),_:1})])),default:C((()=>[w(y,{modelValue:Ve.value.autoCreateApiToSql,"onUpdate:modelValue":i[10]||(i[10]=e=>Ve.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),w(s,null,{label:C((()=>[w(g,{content:"注：自动迁移生成的文件到yaml配置的对应位置",placement:"bottom",effect:"light"},{default:C((()=>[X])),_:1})])),default:C((()=>[w(y,{modelValue:Ve.value.autoMoveFile,"onUpdate:modelValue":i[11]||(i[11]=e=>Ve.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),x("div",W,[x("div",G,[w(r,{size:"small",type:"primary",onClick:i[12]||(i[12]=e=>Fe())},{default:C((()=>[H])),_:1})]),w(D,{data:Ve.value.fields},{default:C((()=>[w(N,{align:"left",type:"index",label:"序列",width:"60"}),w(N,{align:"left",prop:"fieldName",label:"Field名"}),w(N,{align:"left",prop:"fieldDesc",label:"中文名"}),w(N,{align:"left",prop:"require",label:"是否必填"},{default:C((({row:e})=>[q(F(e.require?"是":"否"),1)])),_:1}),w(N,{align:"left",prop:"fieldJson","min-width":"120px",label:"FieldJson"}),w(N,{align:"left",prop:"fieldType",label:"Field数据类型",width:"130"}),w(N,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"130"}),w(N,{align:"left",prop:"columnName",label:"数据库字段",width:"130"}),w(N,{align:"left",prop:"comment",label:"数据库字段描述",width:"130"}),w(N,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"}),w(N,{align:"left",prop:"dictType",label:"字典",width:"130"}),w(N,{align:"left",label:"操作",width:"300",fixed:"right"},{default:C((e=>[w(r,{size:"small",type:"primary",link:"",icon:"edit",onClick:l=>Fe(e.row)},{default:C((()=>[K])),_:2},1032,["onClick"]),w(r,{size:"small",type:"primary",link:"",disabled:0===e.$index,onClick:l=>(e=>{if(0===e)return;const l=Ve.value.fields[e-1];Ve.value.fields.splice(e-1,1),Ve.value.fields.splice(e,0,l)})(e.$index)},{default:C((()=>[Q])),_:2},1032,["disabled","onClick"]),w(r,{size:"small",type:"primary",link:"",disabled:e.$index+1===Ve.value.fields.length,onClick:l=>(e=>{if(e===Ve.value.fields.length-1)return;const l=Ve.value.fields[e+1];Ve.value.fields.splice(e+1,1),Ve.value.fields.splice(e,0,l)})(e.$index)},{default:C((()=>[Y])),_:2},1032,["disabled","onClick"]),w(h,{modelValue:e.row.visible,"onUpdate:modelValue":l=>e.row.visible=l,placement:"top"},{reference:C((()=>[w(r,{size:"small",type:"primary",link:"",icon:"delete",onClick:l=>e.row.visible=!0},{default:C((()=>[te])),_:2},1032,["onClick"])])),default:C((()=>[Z,x("div",ee,[w(r,{size:"small",type:"primary",link:"",onClick:l=>e.row.visible=!1},{default:C((()=>[le])),_:2},1032,["onClick"]),w(r,{type:"primary",size:"small",onClick:l=>{return a=e.$index,void Ve.value.fields.splice(a,1);var a}},{default:C((()=>[ae])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),x("div",ie,[w(r,{size:"small",type:"primary",onClick:i[13]||(i[13]=e=>Ae(!0))},{default:C((()=>[oe])),_:1}),w(r,{size:"small",type:"primary",onClick:i[14]||(i[14]=e=>Ae(!1))},{default:C((()=>[ue])),_:1})])]),w(L,{modelValue:Te.value,"onUpdate:modelValue":i[15]||(i[15]=e=>Te.value=e),width:"70%",title:"组件内容"},{footer:C((()=>[x("div",de,[w(r,{size:"small",onClick:Le},{default:C((()=>[ne])),_:1}),w(r,{size:"small",type:"primary",onClick:De},{default:C((()=>[se])),_:1})])])),default:C((()=>[Te.value?(_(),U(l,{key:0,ref:"fieldDialogNode","dialog-middle":xe.value},null,8,["dialog-middle"])):j("",!0)])),_:1},8,["modelValue"]),w(L,{modelValue:ze.value,"onUpdate:modelValue":i[17]||(i[17]=e=>ze.value=e)},{header:C((()=>[x("div",re,[me,w(r,{size:"small",type:"primary",onClick:Se},{default:C((()=>[pe])),_:1}),w(r,{size:"small",type:"primary",onClick:qe},{default:C((()=>[ce])),_:1})])])),footer:C((()=>[x("div",ve,[w(r,{size:"small",type:"primary",onClick:i[16]||(i[16]=e=>ze.value=!1)},{default:C((()=>[fe])),_:1})])])),default:C((()=>[ze.value?(_(),U(a,{key:0,ref_key:"previewNode",ref:Ue,"preview-code":ge.value},null,8,["preview-code"])):j("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-1a253fc4"]]);export{ge as default};
