/*! 
 Build based on gin-vue-admin 
 Time : 1658720170000 */
var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a,t)=>new Promise(((l,u)=>{var r=e=>{try{o(t.next(e))}catch(a){u(a)}},i=e=>{try{o(t.throw(e))}catch(a){u(a)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,i);o((t=t.apply(e,a)).next())}));import{g as i,d as o,c as d,u as n,a as s}from"./gin-vue-admin-authority.16587201700002.js";import y from"./gin-vue-admin-menus.1658720170000.js";import h from"./gin-vue-admin-apis.1658720170000.js";import v from"./gin-vue-admin-datas.1658720170000.js";import{W as m}from"./gin-vue-admin-warningBar.1658720170000.js";import{r as c,b as p,o as f,c as I,e as g,d as b,w,q as k,f as _,h as C,B as N,i as V}from"../gva/gin-vue-admin-index.1658720170000.js";import"./gin-vue-admin-authorityBtn.1658720170000.js";import"./gin-vue-admin-api.16587201700002.js";const j={class:"authority"},z={class:"gva-table-box"},x={class:"gva-btn-list"},O=C("新增角色"),A=C("设置权限"),P=C("新增子角色"),B=C("拷贝"),S=C("编辑"),U=C("删除"),q={class:"dialog-footer"},D=C("取 消"),E=C("确 定"),R={name:"Authority"},F=Object.assign(R,{setup(e){const C=c([{authorityId:0,authorityName:"根角色"}]),R=c(!1),F=c("add"),T=c({}),W=c("新增角色"),$=c(!1),G=c(!1),H=c({}),J=c({authorityId:0,authorityName:"",parentId:0}),K=c({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,a,t)=>/^[0-9]*[1-9][0-9]*$/.test(a)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),L=c(1),M=c(0),Q=c(999),X=c([]),Y=c({}),Z=()=>r(this,null,(function*(){const e=yield i(((e,r)=>{for(var i in r||(r={}))t.call(r,i)&&u(e,i,r[i]);if(a)for(var i of a(r))l.call(r,i)&&u(e,i,r[i]);return e})({page:L.value,pageSize:Q.value},Y.value));0===e.code&&(X.value=e.data.list,M.value=e.data.total,L.value=e.data.page,Q.value=e.data.pageSize)}));Z();const ee=(e,a)=>{T.value[e]=a},ae=c(null),te=c(null),le=c(null),ue=(e,a)=>{const t=[ae,te,le];a&&t[a].value.needConfirm&&(t[a].value.enterAndNext(),t[a].value.needConfirm=!1)},re=e=>{N.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>r(this,null,(function*(){0===(yield o({authorityId:e.authorityId})).code&&(V({type:"success",message:"删除成功!"}),1===X.value.length&&L.value>1&&L.value--,Z())})))).catch((()=>{V({type:"info",message:"已取消删除"})}))},ie=c(null),oe=()=>{ie.value&&ie.value.resetFields(),J.value={authorityId:0,authorityName:"",parentId:0}},de=()=>{oe(),$.value=!1,G.value=!1},ne=()=>{if(J.value.authorityId=Number(J.value.authorityId),0===J.value.authorityId)return V({type:"error",message:"角色id不能为0"}),!1;ie.value.validate((e=>r(this,null,(function*(){if(e){switch(F.value){case"add":0===(yield s(J.value)).code&&(V({type:"success",message:"添加成功!"}),Z(),de());break;case"edit":0===(yield n(J.value)).code&&(V({type:"success",message:"添加成功!"}),Z(),de());break;case"copy":{const e={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};e.authority.authorityId=J.value.authorityId,e.authority.authorityName=J.value.authorityName,e.authority.parentId=J.value.parentId,e.authority.dataAuthorityId=H.value.dataAuthorityId,e.oldAuthorityId=H.value.authorityId;0===(yield d(e)).code&&(V({type:"success",message:"复制成功！"}),Z())}}oe(),$.value=!1}}))))},se=()=>{C.value=[{authorityId:0,authorityName:"根角色"}],ye(X.value,C.value,!1)},ye=(e,a,t)=>{J.value.authorityId=String(J.value.authorityId),e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===J.value.authorityId,children:[]};ye(e.children,l.children,t||e.authorityId===J.value.authorityId),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===J.value.authorityId};a.push(l)}}))},he=e=>{oe(),W.value="新增角色",F.value="add",J.value.parentId=e,se(),$.value=!0};return(e,a)=>{const t=p("el-button"),l=p("el-table-column"),u=p("el-table"),r=p("el-cascader"),i=p("el-form-item"),o=p("el-input"),d=p("el-form"),n=p("el-dialog"),s=p("el-tab-pane"),c=p("el-tabs"),N=p("el-drawer");return f(),I("div",j,[g(m,{title:"注：右上角头像下拉可切换角色"}),b("div",z,[b("div",x,[g(t,{size:"small",type:"primary",icon:"plus",onClick:a[0]||(a[0]=e=>he(0))},{default:w((()=>[O])),_:1})]),g(u,{data:X.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:w((()=>[g(l,{label:"角色ID","min-width":"180",prop:"authorityId"}),g(l,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),g(l,{align:"left",label:"操作",width:"460"},{default:w((e=>[g(t,{icon:"setting",size:"small",type:"primary",link:"",onClick:a=>{return t=e.row,R.value=!0,void(T.value=t);var t}},{default:w((()=>[A])),_:2},1032,["onClick"]),g(t,{icon:"plus",size:"small",type:"primary",link:"",onClick:a=>he(e.row.authorityId)},{default:w((()=>[P])),_:2},1032,["onClick"]),g(t,{icon:"copy-document",size:"small",type:"primary",link:"",onClick:a=>(e=>{se(),W.value="拷贝角色",F.value="copy";for(const a in J.value)J.value[a]=e[a];H.value=e,$.value=!0})(e.row)},{default:w((()=>[B])),_:2},1032,["onClick"]),g(t,{icon:"edit",size:"small",type:"primary",link:"",onClick:a=>(e=>{se(),W.value="编辑角色",F.value="edit";for(const a in J.value)J.value[a]=e[a];se(),$.value=!0})(e.row)},{default:w((()=>[S])),_:2},1032,["onClick"]),g(t,{icon:"delete",size:"small",type:"primary",link:"",onClick:a=>re(e.row)},{default:w((()=>[U])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),g(n,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),title:W.value},{footer:w((()=>[b("div",q,[g(t,{size:"small",onClick:de},{default:w((()=>[D])),_:1}),g(t,{size:"small",type:"primary",onClick:ne},{default:w((()=>[E])),_:1})])])),default:w((()=>[g(d,{ref_key:"authorityForm",ref:ie,model:J.value,rules:K.value,"label-width":"80px"},{default:w((()=>[g(i,{label:"父级角色",prop:"parentId"},{default:w((()=>[g(r,{modelValue:J.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>J.value.parentId=e),style:{width:"100%"},disabled:"add"==F.value,options:C.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),g(i,{label:"角色ID",prop:"authorityId"},{default:w((()=>[g(o,{modelValue:J.value.authorityId,"onUpdate:modelValue":a[2]||(a[2]=e=>J.value.authorityId=e),disabled:"edit"==F.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),g(i,{label:"角色姓名",prop:"authorityName"},{default:w((()=>[g(o,{modelValue:J.value.authorityName,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),R.value?(f(),k(N,{key:0,modelValue:R.value,"onUpdate:modelValue":a[5]||(a[5]=e=>R.value=e),"with-header":!1,size:"40%",title:"角色配置"},{default:w((()=>[g(c,{"before-leave":ue,class:"role-box",type:"border-card"},{default:w((()=>[g(s,{label:"角色菜单"},{default:w((()=>[g(y,{ref_key:"menus",ref:ae,row:T.value,onChangeRow:ee},null,8,["row"])])),_:1}),g(s,{label:"角色api"},{default:w((()=>[g(h,{ref_key:"apis",ref:te,row:T.value,onChangeRow:ee},null,8,["row"])])),_:1}),g(s,{label:"资源权限"},{default:w((()=>[g(v,{ref_key:"datas",ref:le,authority:X.value,row:T.value,onChangeRow:ee},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):_("",!0)])}}});export{F as default};
