/*! 
 Build based on gin-vue-admin 
 Time : 1658731650000 */
var e=(e,a,t)=>new Promise(((l,o)=>{var n=e=>{try{u(t.next(e))}catch(a){o(a)}},s=e=>{try{u(t.throw(e))}catch(a){o(a)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,s);u((t=t.apply(e,a)).next())}));import{r as a,b as t,o as l,c as o,d as n,e as s,w as u,t as r,G as d,h as i,f as c,a1 as m,a2 as y,i as h,a3 as p,J as f}from"../gva/gin-vue-admin-index.1658731650000.js";import{u as v}from"./gin-vue-admin-authority.16587316500002.js";import{g as k,s as I}from"./gin-vue-admin-authorityBtn.1658731650000.js";const g={class:"clearfix"},w=i("确 定"),b={class:"custom-tree-node"},C={key:0},_=i(" 分配按钮 "),x={class:"dialog-footer"},R=i("取 消"),D=i("确 定"),j={name:"Menus"},z=Object.assign(j,{props:{row:{default:function(){return{}},type:Object}},emits:["changeRow"],setup(j,{expose:z,emit:N}){const A=j,B=a([]),E=a([]),V=a(!1),O=a({children:"children",label:function(e){return e.meta.title}});(()=>{e(this,null,(function*(){const e=yield m();B.value=e.data.menus;const a=(yield y({authorityId:A.row.authorityId})).data.menus,t=[];a.forEach((e=>{a.some((a=>a.parentId===e.menuId))||t.push(Number(e.menuId))})),E.value=t}))})();const P=a=>e(this,null,(function*(){const e=yield v({authorityId:A.row.authorityId,AuthorityName:A.row.authorityName,parentId:A.row.parentId,defaultRouter:a.name});0===e.code&&(h({type:"success",message:"设置成功"}),N("changeRow","defaultRouter",e.data.authority.defaultRouter))})),S=()=>{V.value=!0},T=a(null),G=()=>e(this,null,(function*(){const e=T.value.getCheckedNodes(!1,!0);0===(yield p({menus:e,authorityId:A.row.authorityId})).code&&h({type:"success",message:"菜单设置成功!"})}));z({enterAndNext:()=>{G()},needConfirm:V});const J=a(!1),M=a([]),U=a([]),q=a();let F="";const H=a=>e(this,null,(function*(){F=a.ID;const e=yield k({menuID:F,authorityId:A.row.authorityId});0===e.code&&(L(a),yield f(),e.data.selected&&e.data.selected.forEach((e=>{M.value.some((a=>{a.ID===e&&q.value.toggleRowSelection(a,!0)}))})))})),K=e=>{U.value=e},L=e=>{J.value=!0,M.value=e.menuBtn},Q=()=>{J.value=!1},W=()=>e(this,null,(function*(){const e=U.value.map((e=>e.ID));0===(yield I({menuID:F,selected:e,authorityId:A.row.authorityId})).code&&(h({type:"success",message:"设置成功"}),J.value=!1)}));return(e,a)=>{const m=t("el-button"),y=t("el-tree"),h=t("el-table-column"),p=t("el-table"),f=t("el-dialog");return l(),o("div",null,[n("div",g,[s(m,{class:"fl-right",size:"small",type:"primary",onClick:G},{default:u((()=>[w])),_:1})]),s(y,{ref_key:"menuTree",ref:T,data:B.value,"default-checked-keys":E.value,props:O.value,"default-expand-all":"","highlight-current":"","node-key":"ID","show-checkbox":"",onCheck:S},{default:u((({node:e,data:a})=>[n("span",b,[n("span",null,r(e.label),1),n("span",null,[s(m,{type:"primary",link:"",size:"small",style:d({color:j.row.defaultRouter===a.name?"#E6A23C":"#85ce61"}),disabled:!e.checked,onClick:()=>P(a)},{default:u((()=>[i(r(j.row.defaultRouter===a.name?"首页":"设为首页"),1)])),_:2},1032,["style","disabled","onClick"])]),a.menuBtn.length?(l(),o("span",C,[s(m,{type:"primary",link:"",size:"small",onClick:()=>H(a)},{default:u((()=>[_])),_:2},1032,["onClick"])])):c("",!0)])])),_:1},8,["data","default-checked-keys","props"]),s(f,{modelValue:J.value,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),title:"分配按钮","destroy-on-close":""},{footer:u((()=>[n("div",x,[s(m,{size:"small",onClick:Q},{default:u((()=>[R])),_:1}),s(m,{size:"small",type:"primary",onClick:W},{default:u((()=>[D])),_:1})])])),default:u((()=>[s(p,{ref_key:"btnTableRef",ref:q,data:M.value,"row-key":"ID",onSelectionChange:K},{default:u((()=>[s(h,{type:"selection",width:"55"}),s(h,{label:"按钮名称",prop:"name"}),s(h,{label:"按钮备注",prop:"desc"})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}}});export{z as default};
